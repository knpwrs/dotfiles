# Load zsh modules
autoload -U colors && colors
autoload -Uz compinit && compinit

# Source everything ending in .zsh in the lib directory.
for rcfile in $DOTFILESLIB/*.zsh; do
  source $rcfile
done

# Set up NVM
export NVM_SH="$HOME/.nvm/nvm.sh"
if [ -x $NVM_SH ]; then
  source $NVM_SH
fi
# https://github.com/creationix/nvm/issues/860
alias node='unalias node npm && nvm use stable && node'
alias lode='unalias lode && node -v > /dev/null'
alias npm='lode && npm'

# Load syntax highlighting
source $DOTFILES/vendor/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# Tell the terminal about the working directory at each prompt.
# http://apple.stackexchange.com/a/128999
if [ "$TERM_PROGRAM" == "Apple_Terminal" ] && [ -z "$INSIDE_EMACS" ]; then
    update_terminal_cwd() {
        # Identify the directory using a "file:" scheme URL,
        # including the host name to disambiguate local vs.
        # remote connections. Percent-escape spaces.
        local SEARCH=' '
        local REPLACE='%20'
        local PWD_URL="file://$HOSTNAME${PWD//$SEARCH/$REPLACE}"
        printf '\e]7;%s\a' "$PWD_URL"
    }
    PROMPT_COMMAND="update_terminal_cwd; $PROMPT_COMMAND"
fi
